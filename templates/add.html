{% extends "base.html" %}
{% set title = "Add Roll - " ~ warehouse %}

{% block content %}

<form method="POST" action="{{ url_for('add_form', warehouse=warehouse) }}">

  <label>Location ({{ warehouse }})</label>
  <select name="location" id="location" required>
    <option value="" selected disabled>Select a locationâ€¦</option>
    {% for loc in locations %}
      <option value="{{ loc }}">{{ loc }}</option>
    {% endfor %}
  </select>

  <label>Paper Type</label>
  <input type="text" name="paper_type" id="paper_type" required autocomplete="off">

  <label>Roll ID</label>
  <input type="text" name="roll_id" id="roll_id" required autocomplete="off">

  <label>Weight</label>
  <input type="number" name="weight" id="weight" required autocomplete="off" step="1" min="1">

  <button class="btn primary" type="submit">Add Roll</button>
</form>

<script>
(function(){
  const wh = "{{ warehouse }}";
  const key = "sticky_location_" + wh;

  const sel  = document.getElementById("location");
  const paper= document.getElementById("paper_type");
  const roll = document.getElementById("roll_id");

  // Restore sticky location (but still let user change it)
  const saved = localStorage.getItem(key);
  if(saved && sel){
    for(const opt of sel.options){
      if(opt.value === saved){
        sel.value = saved;
        break;
      }
    }
  }

  // Focus location first so you can select it
  window.addEventListener("load", () => {
    if(sel) sel.focus();
  });

  // Save sticky location + move focus to Paper Type
  if(sel){
    sel.addEventListener("change", () => {
      localStorage.setItem(key, sel.value);
      setTimeout(() => paper && paper.focus(), 80);
    });
  }

})();
</script>

{% endblock %}
