{% extends "base.html" %}
{% set title = "Edit / Move Roll" %}
{% block content %}

<h3>Edit Roll: {{ r.roll_id }}</h3>

<form method="post" autocomplete="off">

  <label>Paper Type</label>
  <input name="paper_type" value="{{ r.paper_type }}" required>

  <label>Weight (lbs)</label>
  <input name="weight"
         value="{{ r.weight }}"
         inputmode="numeric"
         placeholder="Leave blank to keep current weight">

  <label>Warehouse</label>
  <select name="warehouse" id="warehouse" required>
    {% for w in warehouses %}
      <option value="{{ w }}" {% if r.warehouse == w %}selected{% endif %}>{{ w }}</option>
    {% endfor %}
  </select>

  <label>Sublocation</label>
  <select name="location" id="location" required></select>

  <br>

  <button class="btn primary" type="submit">Save Changes</button>

</form>

<hr style="margin:30px 0;">

<form method="post"
      action="{{ url_for('delete_roll_pc', roll_id=r.roll_id) }}"
      onsubmit="return confirm('DELETE this roll permanently? This cannot be undone.');">

  <button class="btn danger" type="submit">
    DELETE THIS ROLL
  </button>

</form>

<script>
const wh1 = {{ locations_for('WH1')|tojson }};
const wh2 = {{ locations_for('WH2')|tojson }};
const used = ["USED"];

const currentWH = "{{ r.warehouse }}";
const currentLoc = "{{ r.location }}";

const whEl = document.getElementById("warehouse");
const locEl = document.getElementById("location");

function fillLocations(wh, selected=null){
  locEl.innerHTML = "";

  let list = [];
  if(wh === "WH1") list = wh1;
  else if(wh === "WH2") list = wh2;
  else list = used;

  list.forEach(v=>{
    const opt = document.createElement("option");
    opt.value = v;
    opt.textContent = v;
    if(v === (selected || currentLoc)) opt.selected = true;
    locEl.appendChild(opt);
  });
}

whEl.addEventListener("change", ()=>{
  fillLocations(whEl.value, null);
});

fillLocations(currentWH, currentLoc);
</script>

{% endblock %}
