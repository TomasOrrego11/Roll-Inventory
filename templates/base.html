<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>{{ title or "Roll Inventory" }}</title>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#f4f6f9;
  color:#1f2937;
}

.wrap{
  max-width:1200px;
  margin:auto;
  padding:25px;
}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:white;
  padding:15px 20px;
  border-radius:10px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
  margin-bottom:25px;
}

.btn{
  display:block;
  background:#2563eb;
  color:white;
  text-decoration:none;
  padding:16px;
  margin:10px 0;
  border-radius:10px;
  text-align:center;
  font-weight:bold;
  transition:.2s;
  border:none;
}

.btn:hover{
  background:#1d4ed8;
  transform:translateY(-1px);
}

.nav{
  display:flex;
  gap:10px;
  align-items:center;
}

.grid2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}

input, select, textarea{
  width:100%;
  padding:14px;
  font-size:18px;
  margin-bottom:15px;
  border-radius:8px;
  border:1px solid #d1d5db;
}

/* flashes */
.flash{
  padding:12px;
  border-radius:8px;
  margin-bottom:15px;
  font-weight:bold;
}
.flash.success{
  background:#dcfce7;
  color:#166534;
  border:1px solid #22c55e;
}
.flash.error{
  background:#fee2e2;
  color:#991b1b;
  border:1px solid #ef4444;
}

/* ---------- SCANNER MODE (PERSISTENT) ---------- */
.fullscreen-btn{
  background:#10b981;
  border:none;
  cursor:pointer;
}
.fullscreen-btn:hover{
  background:#059669;
}

.scan-mode .wrap{
  max-width:100%;
}

.scan-mode input, .scan-mode textarea, .scan-mode select{
  font-size:34px;
  padding:28px;
  text-align:center;
}

.scan-mode h2{
  font-size:28px;
}

</style>
</head>

<body>

<div class="wrap">

  <div class="topbar">
    <h2>{{ title or "Roll Inventory" }}</h2>

    <div class="nav">
      <a class="btn" href="{{ url_for('home') }}">Back</a>
      <button class="btn fullscreen-btn" id="scannerBtn" type="button" onclick="toggleScannerMode()">Scanner Mode</button>
      <a class="btn" href="{{ url_for('logout') }}">Logout</a>
    </div>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {% block content %}{% endblock %}

</div>

<script>
/* ---------- AUTOFOCUS TOP INPUT ---------- */
function focusTop(){
  const el = document.querySelector("input:not([type=hidden]):not([readonly]), textarea, select");
  if(el){
    el.focus();
    el.select?.();
  }
}

/* ---------- SOUND ON SUBMIT ---------- */
document.addEventListener("submit", function(){
  const audio = new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");
  audio.play().catch(()=>{});
});

/* ---------- PERSISTENT SCANNER MODE ---------- */
function applyScannerMode(on){
  if(on){
    document.body.classList.add("scan-mode");
    localStorage.setItem("scannerMode","on");
    document.getElementById("scannerBtn").textContent = "Exit Scanner";
  }else{
    document.body.classList.remove("scan-mode");
    localStorage.setItem("scannerMode","off");
    document.getElementById("scannerBtn").textContent = "Scanner Mode";
  }
}

function toggleScannerMode(){
  const isOn = document.body.classList.contains("scan-mode");
  applyScannerMode(!isOn);

  // try to enter/exit fullscreen too
  if(!isOn){
    if(!document.fullscreenElement){
      document.documentElement.requestFullscreen().catch(()=>{});
    }
  }else{
    if(document.fullscreenElement){
      document.exitFullscreen().catch(()=>{});
    }
  }
  setTimeout(focusTop,120);
}

/* restore on page load */
window.addEventListener("load", function(){
  const saved = localStorage.getItem("scannerMode");
  if(saved === "on"){
    applyScannerMode(true);
  }else{
    applyScannerMode(false);
  }
  focusTop();
});

/* if user exits fullscreen manually, keep scan-mode but update button */
document.addEventListener("fullscreenchange", function(){
  const isOn = document.body.classList.contains("scan-mode");
  if(isOn){
    document.getElementById("scannerBtn").textContent = document.fullscreenElement ? "Exit Scanner" : "Scanner Mode (FS off)";
  }
});
</script>

</body>
</html>
